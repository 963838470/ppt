<!DOCTYPE html>
<html ng-app="myapp" ng-controller="ServiceController">
<head>
    <meta charset="utf-8" />
    <title>首页</title>
    <!-- base -->
    <link href="style/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <script src="framework/angular.js"></script>
    <script src="framework/angular-route.js"></script>
    <script src="framework/angular-animate.js"></script>
    <script src="framework/angular-ui-router.js"></script>
    <script>
        var app = angular.module("myapp", []);
        app.factory('userListService', ['$http',
            function ($http) {
                var i = 0;
                var doRequest = function (username, path) {
                    console.log(++i);
                    //return $http({
                    //    method: 'GET',
                    //    url: 'users.json'
                    //});
                }
                return {
                    userList: function (username) {
                        return doRequest(username, 'userList');
                    }
                };
            }
        ]);

        app.controller('ServiceController', ['$scope', '$timeout', 'userListService',
            // 0.35秒未改变值后执行，后一个值改变事件取消前面的定时执行事件
            function ($scope, $timeout, userListService) {
                var timeout;
                $scope.$watch('username', function (newValue) {
                    if (newValue) {
                        if (timeout) {
                            $timeout.cancel(timeout);
                        }
                        timeout = $timeout(function () {
                            userListService.userList(newValue)
                                .success(function (data, status) {
                                    $scope.users = data;
                                });
                        }, 350);
                    }
                });
            }
        ]);
    </script>
</head>
<body>
    255
    <input type="text" ng-model="username" placeholder="请输入用户名" />

</body>
</html>